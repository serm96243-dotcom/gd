{
  "title": "Безопасная установка",
  "text": "Была ли статья полезной?\nДа\nНет\nСпасибо за вашу оценку!\nОставляя более подробный отзыв, вы помогаете нам улучшать документацию\nКомментарий к оценке\nКонтактная информация (необязательно)\nВложения\nДобавить файл\nОтменить\nОтправить\nБезопасная установка\nСтатья дополняется\nОперационная система\nНа всех серверах установить\nAstra Linux Special Edition 1.7\nлибо\nAstra Linux Special Edition 1.8\n.\nСистема управления базами данных\nУстановить\nPostgres Pro Certified\nлибо\nPostgres Pro Enterprise Certified\n.\n1. Конфигурация PostgreSQL\nВключаем SSL.\nНа сервер СУБД создадим каталог для сертификатов:\nmkdir /etc/postgresql/ssl\nshell\nCopied!\nКладем в него подготовленные файлы:\nca.crt\nserver.crt\nserver.key\nshell\nCopied!\nНазначаем владельца на файлы:\nchown -R postgres:postgres /etc/postgresql\nshell\nCopied!\nСоздадим конфиг с параметрами SSL:\nnano /etc/postgresql/14/main/conf.d/ssl.conf\nshell\nCopied!\nssl = on\nssl_cert_file = '/etc/postgresql/ssl/server.crt'\nssl_key_file = '/etc/postgresql/ssl/server.key'\nssl_ca_file = '/etc/postgresql/ssl/ca.crt'\n#\nThis setting is on by default but it’s always a good idea to\n#\nbe explicit when it comes to security.\nssl_prefer_server_ciphers = on\n#\nTLS 1.3 will give the strongest security and is advised when\n#\ncontrolling both server and clients.\nssl_min_protocol_version = 'TLSv1.3'\nshell\nCopied!\nПерезапускаем СУБД.\n2. Создание базы данных\nОбщая инструкция\nПодготовка базы данных Low-Code\nВажно использовать другое имя схемы\nprivate\n(не дефолтную\npublic\n):\nОтзыв публичных прав на схему\nREVOKE\nALL\nON\nSCHEMA\npublic\nFROM\npublic\n;\nsql\nCopied!\nПереименовать схему\nALTER\nSCHEMA\npublic\nRENAME\nTO\nprivate\n;\nsql\nCopied!\n3. Дамп базы данных\nСкачать и импортнуть первоначальный дамп БД\nhttps://downloads.greendatasoft.ru/db/ru\n(хэш сумма\nhttps://downloads.greendatasoft.ru/db/ru\n).\n4. Усиление безопасности базы данных\n4.1. Отключение публичного доступа к базе данных\nПри создании базы для роли\npublic\n, всем пользователям предоставляются права подключения.\nЧто бы отключить возможность подключения к базе сторонним пользователям используйте команду вида:\nREVOKE\nALL\nON\nDATABASE\nимя_базы\nFROM\npublic\n;\nsql\nCopied!\nПосле чего к базе сможет подключиться только владелец базы, суперпользователи и те,\nкому явно назначен доступ к БД.\nДля разрешения подключения к БД отдельным ролям используйте команду вида:\nGRANT\nCONNECT\nON\nDATABASE\nимя_базы\nTO\nимя_пользователя;\nsql\nCopied!\nДля отзыва этих прав используйте команду вида:\nREVOKE\nCONNECT\nON\nDATABASE\nимя_базы\nFROM\nимя_пользователя;\nsql\nCopied!\n4.2. Использование схемы отличной от\npublic\nПо умолчанию схема\npublic\nпредоставляет для роли\npublic\nряд прав по умолчанию,\nк примеру сторонние пользователи смогут подключаться к схеме, создавать свои объекты,\nпросматривать список объектов. Такое поведение может не соответствовать используемым регламентам безопасности.\nДля исправления такого поведения потребуется отозвать публичные права у схемы, переименовать её,\nперенастроить приложение на работу с новой схемой, воссоздать снова схему public\nдля обеспечения работы расширений.\n4.2.1. Отзыв публичных прав на схему\nДля отзыва публичных прав на схему используйте команду:\nREVOKE\nALL\nON\nSCHEMA\npublic\nFROM\npublic\n;\nsql\nCopied!\nПосле её применение права на подключение к схеме и создание в ней объектов останутся только у владельца базы,\nсуперпользователей и у тех, кому был явно задан доступ.\nВ дальнейшем, для разрешения подключения к схеме нужному пользователю или роли, используйте команду вида:\nGRANT\nUSAGE\nON\nSCHEMA\npublic\nTO\nимя_пользователя;\nsql\nCopied!\n4.2.2. Использование ролей в качестве групп\nДля разграничения прав можно использовать роли, которые могут выступать\nкак в качестве пользователей, так и в качестве групп.\nПример создания такой роли:\nCREATE\nROLE\nrw_public;\nGRANT\nALL\nON\nSCHEMA\npublic\nTO\nrw_public;\nsql\nCopied!\nПосле чего роль можно назначить пользователю командой вида:\nGRANT\nrw_public\nTO\n<\nuser\n>;\nsql\nCopied!\nОтозвать роль можно командой вида:\nREVOKE\nrw_public\nFROM\nuser\n;\nsql\nCopied!\n4.2.3. Переименование схемы\nДля переименования схемы используйте команду вида:\nALTER\nSCHEMA\npublic\nRENAME\nTO\nprivate\n;\nsql\nCopied!\nВ данном случае схема public будет переименована в private.\n4.2.4. Смена владельца схемы\nПри необходимости сменить владельца схемы используйте команду вида:\nALTER\nSCHEMA\npublic\nOWNER\nto\nlowcode_user;\nsql\nCopied!\n4.2.5. Воссоздание схемы public\nСтандартная схема public требуется для работы некоторых расширений, для её воссоздания используйте команду:\nCREATE\nSCHEMA\npublic\n;\nsql\nCopied!\nПосле чего необходимо вернуть публичные права:\nGRANT\nUSAGE\nON\nSCHEMA\npublic\nTO\npublic\n;\nGRANT\nCREATE\nON\nSCHEMA\npublic\nTO\npublic\n;\nsql\nCopied!\nСервер приложения\nНа серверах приложения установить\nAxiom JDK Certified 17\n.\nПлатформа\nСкачать платформу\nhttps://downloads.greendatasoft.ru/LTS\n(хэш сумма\nhttps://downloads.greendatasoft.ru/LTS\n).\nНастройка systemctl для запуска платформы\nИнструкция по подготовке платформы для запуска в виде демона systemd из ZIP-архива\nЗапуск Low-Code платформы в виде папки исполняемых файлов\nКонфигурация платформы\nПрописываем аргументы JVM в\napp.conf\n-Djava.security.egd=file:/dev/./urandom\n-Djavax.net.ssl.trustStore=/cacert.jks\n-Djavax.net.ssl.trustStorePassword=INSERT_TRUSTSTORE_PASSWORD\nshell\nCopied!\nВключить строгий режим в\napp.yml\ngreendata-core:\nrestrictions:\nddlDmlMode:\nFULL_DISABLED\nselectMode:\nFULL_DISABLED\nsqlEditor:\nOFF\nstrictAccessControlLevel:\nSTRICT\nobjAttrAccessMode:\nSTRICT\nyaml\nCopied!\nВынести секреты из\napp.yml\nи\napp.conf\nв переменные окружения\nДля переноса учетных данные в переменные окружения необходимо выполнить следующие инструкции:\nСоздадим файл с переменными окружения демона:\nnano /etc/default/lowcode\nПоместим в него строки:\n# Параметры подключения к БД:\nDBUSER='<логин_пользователя_БД>'\nDBPSWD='<пароль_пользователя_БД>'\nconf\nCopied!\nУстановим владельцем файла пользователя root:\nchown root:root /etc/default/lowcode\nЗапретим остальным пользователям доступ к файлу:\nchmod 0600 /etc/default/lowcode\nОтредактируем юнит демона:\nnano /etc/systemd/system/lowcode.service\nДобавим в пункт Service строку:\n...\n[Service]\n...\nEnvironmentFile=/etc/default/lowcode\n...\nconf\nCopied!\nОбновим информацию о демонах:\nsystemctl daemon-reload\nВ файле\napp.yml\nменяем строки:\nspring:\ndatasource:\nusername:\n<логин_пользователя_БД>\npassword:\n<пароль_пользователя_БД>\nyaml\nCopied!\nна\nspring:\ndatasource:\nusername:\n${DBUSER}\npassword:\n${DBPSWD}\nyaml\nCopied!\nОстанавливаем демон:\nsudo systemctl stop lowcode\nЗапускаем демон:\nsudo systemctl start lowcode\nНастроить LDAPS и Kerberos\nИнструкция по настройке LDAP(S) и Kerberos\nПример конфигурации приложения из файла app.yml:\nkerberos:\nenabled:\ntrue\n# включает аутентификацию через kerberos\ndebug:\ntrue\n# включает вывод отладочной информации при аутентификации\nproviders:\n-\nenabled:\ntrue\n# включает конкретный kerberos провайдер\nrealmName:\nLOWCODE.LOCAL\n# имя realm из krb5.conf\nalternateSuffixes:\n# альтернативные суффиксы логинов\n-\nlowcode.ru\nkeytabLocation:\n/home/web/apps/spnego/spnego.keytab\n# путь к keytab файлу\nservicePrincipalName:\nHTTP/spnego.lowcode.com\n# spn приложения\ncreateUserOnLogon:\ntrue\n# создание пользователя, если его нет на стенде при авторизации\nupdateAuthoritiesOnLogon:\ntrue\n# обновление групп доступа при авторизации\ncheckLockInProvider:\ntrue\n# блокировка учетной записи пользователя для входа в систему, если она заблокирован в LDAP\ncheckCommonGroupsOnLogon:\nfalse\n# проверка сопоставления группы при входе в приложение и блокировка пользователя при отсутствии сопоставленных групп\ngroupMappingMethod:\nmerging\n# определение способа объединения групп доступа (MERGING — объединение, EXTERNAL_OVERLAP — замещение)\nuserProviderMapping:\n# маппинг данных для аутентификации пользователя\nsynchronizeEmployeeData:\ntrue\n# синхронизация данных сотрудника с внешним провайдером, если параметр не задан, то по умолчанию используется true\norgStrIdent:\n\"ID_ORG\"\n# идентификатор подразделения сотрудника\nuserTypeIdent:\n\"KERBEROS_USER\"\n# идентификатор типа пользователя\nuserExternalAttrMapping:\n# маппинг атрибутов пользователя (только простые значения атрибутов – без вложенности, без дополнительных преобразований и пр.)\nUSERPRINCIPALNAME:\n\"userPrincipalName\"\nemployeeTypeIdent:\n\"KERBEROS_EMP\"\n# идентификатор типа сотрудника\nemployeeExternalAttrMapping:\n# маппинг атрибутов сотрудника (только простые значения атрибутов – без вложенности, без дополнительных преобразований и пр.)\nSAMACCOUNTNAME:\n\"sAMAccountName\"\nemployeeSearchKeyAttrIdents:\n# определение атрибутов, которые являются частью ключа\n-\n\"SAMACCOUNTNAME\"\n# указываются атрибуты, для которых ранее настроен маппинг через employeeExternalAttrMapping\nldapUserSearchQueries:\n-\nurls:\n# адреса контроллеров домена\n-\nldap://lowcode-dc1.com:389\n-\nldap://lowcode-dc2.com:389\nusername:\n'ldapreader@lowcode.local'\n# учетная запись для подключения к LDAP\npassword:\n'ваш_пароль'\n# пароль от учетной записи\nbase:\n'DC=lowcode,DC=local'\n# DN адрес с которого будет происходить поиск информации\nscope:\nSUBTREE\n# включает поиск в дочерних директориях\nyaml\nCopied!\nВключить аутентификацию в\nRedis\ngreendata-core:\nhttp:\nsessionStorage:\ntype:\n\"REDIS\"\nredis:\ntype:\n\"SINGLE\"\n# указываем тип\naddress:\n'rediss://<домен>:<порт>'\nusername:\n\"user\"\npassword:\n\"password\"\nyaml\nCopied!\nВключить Https (TLSv1.3) на платформе\nНастройка TLS для веб сервера (HTTPS)\nВключить подключение к СУБД с сертификатом\nsslmode=require\nи указать имя схемы\ncurrentSchema=private\nspring:\ndatasource:\nurl:\n'jdbc:postgresql://postgresql.local:5432/db?sslmode=require&currentSchema=private'\nyaml\nCopied!\nНастроить S3 для работы по https\nS3\ns3:\nendpoint:\nhttps://s3-service.local\nregion:\nus-east-1\naccessKey:\nabc123\nsecretKey:\ndef345\nbucketName:\nmybucket\nyaml\nCopied!\nНастроить Keycloak для работы по https\nНастроить интеграцию с использованием\nmTLS для reverse proxy\nНастроить\nOpenSearch\nelasticsearch:\nenabled:\ntrue\nusername:\nuser\npassword:\npassword\nnodes:\nhttps://elk-service.local:9200\nyaml\nCopied!\nJKS у JVM\nНастройка приложения для работы по HTTPS\nОтключить не используемые API\nОграничение вызова HTTP API-методов\ngreendata-core:\nhttp:\nblockedPaths:\n-\npath:\n/api/something/{.*}\n-\npath:\n/api/another/{.*}\nyaml\nCopied!\nУстановить уровень логирования на\nINFO\nв\napp.conf\n-Dlogback.loglevel=INFO\nconf\nCopied!\nИспользовать SMTPS для получения и IMAPS для отправки почты\nБалансировщик\nУстановить Nginx 1.23.2\nКонфигурация Nginx\nВыполнить базовые настройки\n1.2. Проксирование приложения на нескольких узлах\nВключаем\nTLSv1.3\nserver {\n# ...\nssl_certificate /etc/letsencrypt/live/.../fullchain.pem;\nssl_certificate_key /etc/letsencrypt/live/.../privkey.pem;\n# @see https://hynek.me/articles/hardening-your-web-servers-ssl-ciphers/\n# Настройка ключа Диффи-Хилмана (Diffie-Hellman (DH))\nssl_dhparam /etc/nginx/ssl/dhparams.pem;\n## Ограничиваем SSL версией TLSv1.3\nssl_protocols TLSv1.3;\n## Описываем разрешённые шифры. Шифры задаются в формате, поддерживаемом библиотекой OpenSSL:\nssl_ciphers TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-256-GCM-SHA384:TLS13-AES-128-GCM-SHA256:EECDH+CHACHA20:EECDH+AESGCM:EECDH+AES;\n## Указываем, чтобы при использовании протоколов SSLv3 и TLS серверные шифры были более приоритетны, чем клиентские.\nssl_prefer_server_ciphers on;\n# ...\nconf\nCopied!\nБезопасная конфигурация Nginx для работы с messenger\nИнструкция по запуску медиасервера описана\nтут\n.\nВ описанной конфигурации открываем только API для работы мессенджера, при этом Low-Code платформа остается закрытой.\nserver {\n...\nlocation /api/mobile/ {\nallow all;\n...\n}\nlocation /api/messenger/ {\nallow all;\n...\n}\nlocation /ws/ {\nallow all;\n...\n}\nlocation ~ ^/api/(authentication|logout|account)$ {\nallow all;\n...\n}\n}\nconf\nCopied!\nValKey (Redis)\nУстановить ValKey 7.2.4, собрав вместе с TLS.\nhttps://github.com/valkey-io/valkey?tab=readme-ov-file#building-valkey-using-makefile\nОграничить ACL\nНастройка прав ACL с помощью redis-cli\nПрикладная настройка",
  "source": "https://docs.greendata.ru/platform/ru/secure-installation.html"
}