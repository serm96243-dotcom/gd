{
  "title": "Работа с обновлениями через API",
  "text": "Была ли статья полезной?\nДа\nНет\nСпасибо за вашу оценку!\nОставляя более подробный отзыв, вы помогаете нам улучшать документацию\nКомментарий к оценке\nКонтактная информация (необязательно)\nВложения\nДобавить файл\nОтменить\nОтправить\nРабота с обновлениями через API\nПолучение обновлений через API\nФормирование обновления через\nAPI\nосуществляется при помощи запроса:\nс перечислением id объектов, которые войдут в обновление:\n{url}/api/sys/update/to_zip?ids\ntext\nCopied!\nПример запроса:\n/api/sys/update/to_zip?ids=845813,846153,846155\nс указанием id источника на основе SQL, возвращающего id объектов, которые войдут в обновление:\n{url}/api/sys/update/to_zip?sqlSourceId\ntext\nCopied!\nПример запроса:\n/api/sys/update/to_zip?sqlSourceId=890190\nгде {url} – адрес стенда, с которого будут получены обновления.\nВ результате такого запроса\nскачивается zip-архив с файлами обновления\n, где каждый объект представлен отдельным GUF-файлом.\nПолучение обновлений через указанные выше API-запросы доступно только пользователям, аутентифицированным в приложении и имеющим активную cookie-сессию.\nДополнительно в запросе можно использовать следующие параметры:\nПараметр\nНазначение\nonlyAccess\nВ обновление собираются только права доступа на указанные объекты.\nПример запроса:\n/api/sys/update/to_zip?sqlSourceId=890190&onlyAccess=true\ntext\nCopied!\nfileName\nШаблон имени скачиваемого файла обновления.\nПример запроса:\n/api/sys/update/to_zip?sqlSourceId=890190&onlyAccess=true&fileName=ACCESS\ntext\nCopied!\nС указанным шаблоном будет получен файл \"ACCESS_2024_08_15_06_55_03.zip\".\nreplaceValues\nУдаление объектов (атрибутов, выражений, индексов, алгоритмов ЖЦ и/ или проверок) на стенде, куда устанавливается обновление, если они удалены на текущей схеме. То есть на целевом стенде останутся только те объекты, которые имеются в обновлении.\nЯвляется аналогом опции \"заменять значения\", используемой при\nсборке обновлений\nчерез интерфейс.\nПример запроса:\n/api/sys/update/to_zip?sqlSourceId=890190&replaceValues=true\ntext\nCopied!\nexcludedAttrs\nИсключение атрибутов и их значений из обновления. Список задается посредством перечисления идентификаторов атрибутов.\nПример запроса:\n/api/sys/update/to_zip?ids=845922&excludedAttrs=BASED_ON_SOURCE,RF_SOURCE_ID\ntext\nCopied!\nonlyRequired\nДобавление в обновление только обязательных атрибутов.\nБывают исключения, например, для типов объектов добавляются атрибуты PARENT_ID, TYPE_ATTRS.\nПример запроса:\n/api/sys/update/to_zip?ids=845922&onlyRequired=true\ntext\nCopied!\nexcludeLocalAttr\nИсключение из атрибутивного состава типа объектов, добавленного в обновление,  атрибутов\nтипа \"Дочерний объект\"\n.\nПример запроса:\n/api/sys/update/to_zip?ids=845922&excludeLocalAttr=true\ntext\nCopied!\nАлгоритм переноса большого количества взаимосвязанных типов\nДля переноса большого количества взаимосвязанных типов рекомендуется:\nСформировать обновление с использованием параметра\nonlyRequired=true\n.\nПри формировании обновления важно учитывать иерархию – то есть в первую очередь указываются родительские типы, а после – дочерние. Корректный порядок можно получить, используя в источнике на основе SQL иерархический запрос.\nСформировать обновление, исключая атрибуты:\nтипа \"Дочерний объект\" при помощи параметра\nexcludeLocalAttr=true\n;\nссылающиеся на другие атрибуты (например, TYPE_EXPRESSIONS,INDEXES,KEYS,RESTRICTIONS,COMPILED_CODE), при помощи параметра\nexcludedAttrs\n.\nСформировать обновление, включая атрибуты типа \"Дочерний объект\" посредством параметра\nexcludeLocalAttr=false\n, при этом исключая остальные атрибуты, которые могут ссылаться на другие атрибуты.\nСформировать обновление, добавляя выражения, ключи, индексы, проверки, переопределение атрибутов и т.д.\nСформировать обновление без исключений.\nСформировать обновление с правами, используя параметр\nonlyAccess=true\n.\nВ ходе установки может возникнуть потребность переноса справочных значений, используемых в алгоритмах, либо в значениях по умолчанию (OVALUE, OVALUE_MULTI), а также источники данных, которые используются в атрибутах на основе источника (RF_SOURCE_ID).\nРабота с обновлениями CI/CD через API\nВ целях автоматизации, для взаимодействия с обновлениями,\nсозданными через CI/CD\n, можно использовать\nAPI\n. При помощи API имеется возможность получить список обновлений, созданных с помощью CI/CD, скачать и установить конкретное обновление.\nВозможность работы с обновлениями CI/CD через API регулируется наличием соответствующих прав:\n\"Чтение экземпляров типа\" для типа объекта \"Обновление, созданное через CI/CD\" [SYS_CI_CD_PUBLISHED];\n\"Чтение\" соответствующего экземпляра обновления.\nПросмотр списка обновлений\nДля получения списка\nопубликованных\nобновлений, используется GET-запрос следующего вида:\ncurl -H\n\"X-LowCode-Private-Token: {token}\"\n{url}/hooks/cicd/updates > {output_json_file_with_updates_list}\nbash\nCopied!\nгде:\n{url} – адрес стенда, осуществляющего поставку обновлений;\n{token} –\nтокен для подключения\n;\n{output_json_file_with_updates_list} – полученный JSON-файл со списком обновлений.\nСкачать\nпример полученного JSON-файла со списком обновлений.\nТокен для подключения рекомендуется передавать через заголовок, однако для получения списка опубликованных обновлений допустимо использование GET-запроса следующего вида.\n{url}/hooks/cicd/{token}/updates\ntext\nCopied!\nСкачивание обновления\nДля скачивания обновления используется GET-запрос следующего вида:\ncurl -H\n\"X-LowCode-Private-Token: {token}\"\n{url}/hooks/cicd/updates/{update_uuid} --output {output_zip_file_with_update}\nbash\nCopied!\nгде:\n{url} – адрес стенда, осуществляющего поставку обновлений;\n{token} –\nтокен для подключения\n;\n{update_uuid} – uuid обновления, которое необходимо скачать;\n{output_zip_file_with_update} – скачанный zip-файл с обновлением.\nПри выполнении запроса на персональное устройство скачивается архив с обновлением.\nТокен для подключения рекомендуется передавать через заголовок, однако для скачивания обновления допустимо использование GET-запроса следующего вида.\n{url}/hooks/cicd/{token}/updates/{update_uuid}\ntext\nCopied!\nПроверка и установка обновления\nДля\nпроверки обновления\nиспользуется POST-запрос следующего вида:\ncurl -H\n\"X-LowCode-Private-Token: {token}\"\n-F\n\"file=@{file_to_install}\"\n{url}/hooks/cicd/apply?install=\nfalse\n> {output_json_file_with_check_results}\nbash\nCopied!\nгде:\n{url} – адрес стенда, осуществляющего поставку обновлений;\n{token} –\nтокен для подключения\n;\n{file_to_install} – имя файла, из которого берется обновление;\n{output_json_file_with_check_results} – полученный JSON-файл с результатами проверки.\nСкачать\nпример полученного JSON-файла с результатами проверки.\nТокен для подключения рекомендуется передавать через заголовок, однако для проверки обновления допустимо использование POST-запроса следующего вида.\n{url}/hooks/cicd/{token}/apply\ntext\nCopied!\nили\n{url}/hooks/cicd/{token}/apply?install=false\ntext\nCopied!\nПараметр \"install\" необязателен и по умолчанию принимает значение false.\nДля\nустановки обновления\nиспользуется POST-запрос следующего вида:\ncurl -H\n\"X-LowCode-Private-Token: {token}\"\n-F\n\"file=@{file_to_install}\"\n{url}/hooks/cicd/apply?install=\ntrue\n> {output_json_file_with_install_results}\nbash\nCopied!\nгде:\n{url} – адрес стенда, осуществляющего поставку обновлений;\n{token} –\nтокен для подключения\n;\n{file_to_install} – имя файла, из которого берется обновление;\n{output_json_file_with_install_results} – полученный json-файл с результатами установки.\nСкачать\nпример полученного json-файла с результатами установки.\nТокен для подключения рекомендуется передавать через заголовок, однако для установки обновления допустимо использование POST-запроса следующего вида.\n{url}/hooks/cicd/{token}/apply?install=true\ntext\nCopied!\nНа вход API принимает GUF-файл или zip-файл с несколькими GUF-файлами.\nНа выходе отображается:\nв случае успешной проверки/установки обновления – статус 200;\nв ином случае – статус 422 и список ошибок в виде JSON.",
  "source": "https://docs.greendata.ru/platform/ru/api-updates.html"
}