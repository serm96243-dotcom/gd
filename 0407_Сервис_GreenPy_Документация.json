{
  "title": "Сервис GreenPy",
  "text": "Была ли статья полезной?\nДа\nНет\nСпасибо за вашу оценку!\nОставляя более подробный отзыв, вы помогаете нам улучшать документацию\nКомментарий к оценке\nКонтактная информация (необязательно)\nВложения\nДобавить файл\nОтменить\nОтправить\nСервис GreenPy\nВ Системе реализовано выполнение python-скриптов. Это предполагает наличие специализированного программного обеспечения (далее ПО): docker.\nЧаще всего установка ПО выполняется на виртуальной машине.\nИспользование python-скриптов доступно в приложении GreenData релиз 1.17 и выше.\nПреимущества сервиса\nДля работы с python-скриптами реализуется сервис GreenPy. Сервис GreenPy намеренно проектируется без прямого подключения к базе данных (далее БД). Такая реализация имеет следующие преимущества:\nснимает угрозу безопасности;\nне препятствует бесперебойному функционированию приложения;\nобеспечивает кроссплатформенность;\nобеспечивает независимость от систем управления БД (далее СУБД);\nобеспечивает работу с массивами данных до нескольких гигабайт.\nРабота на платформе GreenData допускает использование python-скриптов, внутри которых настраивается подключение к необходимой БД и выполняется передача данных. Это решение не рекомендуется к использованию, так как может препятствовать бесперебойной работе приложения. В этом случае ответственность за функционирование приложения ложится на автора скрипта.\nАрхитектура решения\nРабота с сервисом GreenPy предполагает следующие шаги:\nВ процессе выполнения шагов 1 и 2 генерируются файлы с входными данными для выполнения python-скрипта. Для этого используются источники данных на основе SQL.\nНа шаге 3 выполняется копирование данных, необходимых для выполнения python-скрипта, в общее хранилище.\nШаг 4 обеспечивает отправку http/s запроса для инициализации выполнения python-скрипта в сервис GreenPy.\nНа шаге 5 выполняется копирование необходимых для выполнения python-скрипта файлов в контейнер GreenPy из общего хранилища.\nНа шаге 6 выполняется python-скрипт в сервисе GreenPy.\nШаг 7 обеспечивает отправку http/s запроса, содержащего выходные данные, полученные после выполнения python-скрипта, в приложение GreenData.\nАппаратное и программное обеспечение\nИспользование программного и аппаратного обеспечения должно учитывать следующие минимальные требования:\nАппаратное обеспечение (Linux):\nпроцессор: 4 * vCPU;\nОЗУ: 8 Gb;\nнакопители на жёстких магнитных дисках (далее НЖМД): 40Гб (система) + 100Гб (приложение и данные);\nтип диска: SSD;\ndocker для debian:\ndocs.docker.com/engine/install/debian/\nАппаратное обеспечение для осуществления проверки работоспособности(Linux):\nпроцессор: 2 * vCPU;\nОЗУ: 2 Gb;\nнакопители на жёстких магнитных дисках (далее НЖМД): 10Гб (система) + 10Гб (приложение и данные);\nтип диска: SSD;\ndocker для debian:\ndocs.docker.com/engine/install/debian/\nАппаратное обеспечение (Windows):\nоперационная система: Windows Server 2019 Core Standart x64;\nпроцессор: 4 * vCPU;\nОЗУ: 10 Gb;\nНЖМД: 40Гб (система) + 100Гб (приложение и данные).\ndocker для Windows\nТребования к python-скриптам:\nверсия: Python 3;\nподдерживается использование jupyter notebook.\nДля работы c python-скриптами посредством алгоритмов используются функции:\nRunPyScript\n,\nWrapSqlDataSource\n.\nРазвертывание сервиса GreenPy\nДля развертывания сервиса GreenPy необходимо:\nустановить и настроить nfs-cервер на сервере, на котором запускается GreenPy\nподключить docker репозиторий\ndockerhub.greendatasoft.ru\nдля выкачивания образа greenpy на сервере, на котором запускается GreenPy\nнастроить и запустить сервис GreenPy\n1. Установка и настройка nfs-cервера:\nУстановить nfs-cервер, выполнив команду:\napt install nfs-kernel-server nfs-common portmap\nshell\nCopied!\nСоздать общую папку, которая будет использоваться для обмена данными между сервисом и приложением, для этого выполните:\nmkdir -p /mnt/greenpy\nshell\nCopied!\nПапка может находиться в удобном для вас месте на сервере, но общепринято располагать её в каталоге /mnt\nНастроить nfs-каталог, для этого нужно:\nОткрыть файл\n/etc/exports\nnano /etc/exports\nshell\nCopied!\nФайл должен располагаться строго по этому пути\nДобавьте следующую строку в файл\n/etc/exports\n:\n/mnt/greenpy        *(rw,async,nohide,no_root_squash,no_subtree_check,all_squash,anonuid=16,anongid=16)\nshell\nCopied!\n/mnt/greenpy - путь до папки, которая была создана в пункте 2.\nПосле чего выполнить:\nexportfs -ra\nexportfs -s\nshell\nCopied!\n2. Подключение docker репозитория на сервере с GreenPy:\nАвторизоваться в Docker Hub.\nВам необходимо выполнить команду, заменив\n<YOUR_USERNAME>\nи\n<YOUR_PASSWORD>\nна учетные данные, которые были предоставлены вам:\ndocker login -u <YOUR_USERNAME> -p <YOUR_PASSWORD> dockerhub.greendatasoft.ru\nshell\nCopied!\nЗапустить команду, чтобы проверить успешность операции:\ndocker pull dockerhub.greendatasoft.ru/public/greenpy-python:latest\nsh\nCopied!\n3. Настройка и запуск сервиса:\nСоздать папку для сервиса\nGreenPy\n, выполнив:\nmkdir -p /home/web/greenpy\nshell\nCopied!\nПапка может находиться в удобном для вас месте на сервере\nПерейти в папку сервиса\ncd /home/web/greenpy\nshell\nCopied!\nи создать файл docker-compose.yml и разместить в нем следующий конфиг:\nnano docker-compose.yml\nshell\nCopied!\nservices:\ngreenpy-python:\nrestart:\nunless-stopped\nimage:\ndockerhub.greendatasoft.ru/public/greenpy-python:latest\nenvironment:\n-\nWORKDIR_PATH=/home/greenpy/workdir\n-\nSERVER_TIMEOUT=10800\n-\nSERVER_WORKERS=3\n-\nSERVER_THREADS=2\n-\nLIMIT_REQUEST_LINE=4094\n-\nLIMIT_REQUEST_FIELD_SIZE=8190\nvolumes:\n-\n/mnt/greenpy:/home/greenpy/workdir\ncontainer_name:\ngreenpy-python\nports:\n-\n'8787:8080'\nlogging:\ndriver:\nnone\nyaml\nCopied!\n/home/greenpy/workdir - автоматически создаваемый каталог\n/mnt/greenpy - каталог, созданный в пункте 2\nУстановка и настройка nfs-cервера\n8080 - внутренний порт сервиса, который менять не требуется\n8787 - внешний порт, на котором будет работать сервес. Этот порт необходимо будет указать в настройках платформы см.\nПодключение сервиса GreenPy\nЗапустить сервис\nGreenPy\n, выполнив:\ndocker-compose up -d\nshell\nCopied!\nЧтобы остановить сервис, выполните:\ndocker-compose rm -sf\nshell\nCopied!\nНастройка Lowcode платформы для работы с сервисом GreenPy\nУстановить пакет nfs-common на сервере, на котором запущена платформа GreenData, выполнив команду:\napt install nfs-common\nshell\nCopied!\nДополнить файл\ndocker-compose.yml\nследующими строками:\nservices:\nservice-name:\n# ...\nvolumes:\n# ...\n# Монтирования NFS ресурса\n-\ntype:\nvolume\nsource:\ngreenpy_share\ntarget:\n/greenpy_share\nvolume:\nnocopy:\ntrue\n# ...\n# Создание глобального тома, ипользующего NFS ресурс\nvolumes:\ngreenpy_share:\ndriver_opts:\ntype:\nnfs\n# FQDN NFS сервера\no:\n\"addr=УКАЗАТЬ_АДРЕС_NFS_СЕРВЕРА,nolock,soft,rw\"\n# Тут указываем полный путь расшаренной по NFS папки на NFS сервере\ndevice:\n\":/mnt/greenpy\"\nyaml\nCopied!\nУКАЗАТЬ_АДРЕС_NFS_СЕРВЕРА - адрес сервера (IP или доменное имя), где установлен  nfs-сервер из пунка 1\nУстановка и настройка nfs-cервера\n/mnt/greenpy - путь до папки, которая была создана в пункте 2\nУстановка и настройка nfs-cервера\nПерезапустить приложение, выполнив команды:\ndocker-compose rm -sf\ndocker-compose up -d\nshell\nCopied!\nПример python jupyter notebook\nimport pandas as pd\nimport os\nfrom dotenv import load\n_dotenv\nload\n_dotenv()\ndata = { \"in\": [os.getenv(\n'input'\n)] }\n#load data into a DataFrame object:\ndf = pd.DataFrame(data)\ndf.to\n_csv(os.getenv('result'), index=False)\nasciidoc\nCopied!\nДля правильной работы исходный скрипт должен содержать эти строчки:\nfrom dotenv import load\n_dotenv\nload_\ndotenv()\nasciidoc\nCopied!\nПример алгоритма",
  "source": "https://docs.greendata.ru/platform/ru/greenpy-service.html"
}